---
name: Terraform Graph Beautifier

description: Terraform Graph Beautifier

inputs:
  working-directory:
    description: Terraform CLI 実行時のパス
    required: true

runs:
  using: composite
  steps:
    - name: Setup Go
      uses: ./.github/actions/setup-go

    - name: Install Terraform Graph Beautifier
      run: |
        go install github.com/pcasteran/terraform-graph-beautifier@latest

        go version
        which go
        which terraform-graph-beautifier
        which terraform
        terraform -v
        terraform-graph-beautifier -v
      shell: bash

    # - name: Terraform Graph
    #   run: |
    #     terraform graph > dependency-graph.dot

    #     terraform-graph-beautifier --input dependency-graph.dot \
    #       --output-type=cyto-html \
    #       -debug \
    #       > dependency-graph.html
    #   working-directory: ${{ inputs.working-directory }}
    #   shell: bash

    - name: Terraform Graph
      run: |
        terraform graph | \
          sed -e 's/%0A/\\n/g' | \
          sed -e 's/\\t//g' | \
          sed -e 's/\"/"/g' | \
          terraform-graph-beautifier \
          --output-type=cyto-html \
          -debug \
          > dependency-graph.html
      working-directory: ${{ inputs.working-directory }}
      shell: bash
